{% extends "master.html" %}
{% load static %}
{% block title %}Track Request Status{% endblock %}
{% block content %}

<div class="appointment-form">
  <div class="form-card">
    <div class="form-header text-center mb-4">
      <h2>Track Request Status</h2>
      <p>Monitor the progress of your submitted blood requests.</p>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered text-center" style="border-collapse: collapse;">
        <thead>
          <tr>
            <th style="padding: 0.6rem;">Units</th>
            <th style="padding: 0.6rem;">Hospital</th>
            <th style="padding: 0.6rem;">Date Required</th>
            <th style="padding: 0.6rem;">Urgency</th>
            <th style="padding: 0.6rem;">Status</th>
            <th style="padding: 0.6rem;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for req in blood_requests %}
          <tr>
            <td style="padding: 0.6rem;">{{ req.units_Requested }}</td>
            <td style="padding: 0.6rem;">{{ req.hospital_Name }}</td>
            <td style="padding: 0.6rem;">{{ req.date_Required|date:"M d, Y" }}</td>
            <td style="padding: 0.6rem;">
              {% if req.is_Emergency %}
              <span class="badge bg-danger">Emergency</span>
              {% else %}
              <span class="badge bg-info text-dark">Normal</span>
              {% endif %}
            </td>
            <td style="padding: 0.6rem;">
              {% if req.status == "Approved" %}
              <span class="badge bg-success">Approved</span>
              {% elif req.status == "Pending" %}
              <span class="badge bg-warning text-dark">Pending</span>
              {% elif req.status == "Rejected" %}
              <span class="badge bg-danger">Rejected</span>
              {% else %}
              <span class="badge bg-secondary">Completed</span>
              {% endif %}
            </td>
            <td style="padding: 0.6rem;">
              {% if req.status == "Pending" %}
              <a href="{% url 'edit_patient_request' req.id %}" class="btn-edit">Edit</a>
              <form method="post" action="{% url 'delete_patient_request' req.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn-delete" onclick="return confirm('Are you sure you want to delete this request?');">Delete</button>
              </form>
              {% else %}
              <span class="text-muted">N/A</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-muted" style="padding: 0.6rem;">No blood requests found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Back to Dashboard Button -->
    <div class="center">
      <a href="{% url 'patient_dashboard' %}" class="back-btn">Back to Dashboard</a>
    </div>

  </div>
</div>

{% endblock %}
